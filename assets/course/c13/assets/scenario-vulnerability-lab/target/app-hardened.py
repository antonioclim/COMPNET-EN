from flask import Flask, request, abort
import subprocess
import ipaddress

app = Flask(__name__)

@app.get("/")
def index():
    return "target up (hardened)\n"

@app.get("/ping")
def ping():
    host = request.args.get("host", "127.0.0.1")

    try:
        ipaddress.ip_address(host)
    except Exception:
        abort(400, "invalid host")

    proc = subprocess.run(
        ["ping", "-c", "1", host],
        capture_output=True,
        text=True,
        timeout=2
    )

    return (proc.stdout + proc.stderr) + "\n"
