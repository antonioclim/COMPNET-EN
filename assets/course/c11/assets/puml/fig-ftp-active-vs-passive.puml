@startuml

skinparam backgroundColor white
skinparam shadowing false
skinparam roundcorner 12
skinparam defaultFontName Arial
skinparam defaultFontSize 14

title FTP: active vs passive (cine initiaza conexiunea de date)

actor Client
node "FTP Server" as S

rectangle "Active mode" as A {
  Client -> S : TCP 21 (control)
  Client -> S : PORT client_ip:client_port
  S -> Client : TCP data\nserver:20 -> client:client_port
  note right of A
  Problema tipica:
  clientul e in spatele NAT/firewall
  conexiuni inbound catre client pot fi blocate
  end note
}

rectangle "Passive mode" as P {
  Client -> S : TCP 21 (control)
  Client -> S : PASV
  S -> Client : "use server_ip:server_port"
  Client -> S : TCP data\nclient:ephemeral -> server:server_port
  note right of P
  Mai prietenos cu NAT/firewall:
  clientul initiaza si control si data
  end note
}

@enduml