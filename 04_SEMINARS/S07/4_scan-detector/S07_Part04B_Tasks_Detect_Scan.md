### Tasks — Detecting a Port Scan (Stage 5)

In this stage you will use detect_scan.py to detect a port scan
generated by port_scanner.py.

The ideal scenario is in Mininet, but it can also be adapted on a single machine.

---

### 1. Preparing the environment (Mininet, recommended)

1. Start a simple topology (for example the one with h1 and h2 from previous seminars).
2. In the Mininet CLI, make sure that:
   - h1 has an IP address (e.g. 10.0.10.1)
   - h2 has an IP address (e.g. 10.0.10.2)

We shall assume that:
- **h1** will run port_scanner.py (attacker)
- **h2** will run detect_scan.py (victim / server)

---

### 2. Run detect_scan on h2

In the Mininet CLI:

```bash
h2 sudo python3 detect_scan.py h2-eth0
````

You should see:

* `[INFO] Starting detect_scan ...`
* the window and threshold configuration

Leave the script running.

---

### 3. Run port_scanner on h1

In a separate terminal, in the Mininet CLI:

```bash
h1 python3 port_scanner.py 10.0.10.2 1 200
```

or a smaller range if it is too slow, for example:

```bash
h1 python3 port_scanner.py 10.0.10.2 20 120
```

As the scanner attempts to connect to multiple ports on h2:

* detect_scan should observe many TCP SYN packets from h1's IP
* if within a 5-second window 10 or more distinct ports are reached,
  the script will display:

```text
[ALERT] Possible port scan from 10.0.10.1: 10 distinct ports in the last 5 seconds
```

(The IP address and port count may vary.)

---

### 4. Adjust the detector's sensitivity

In `detect_scan.py` you have the variables:

```python
WINDOW_SECONDS = 5
PORT_THRESHOLD = 10
```

Task:

1. Change `WINDOW_SECONDS` to 2 seconds and `PORT_THRESHOLD` to 5.
2. Run again:

   * detect_scan on h2
   * port_scanner on h1 (on a similar port range)

Observe:

* does the alert appear more quickly?
* do you risk more false positives?

Record your observations in the log file (see deliverable).

---

### 5. Optional: test without port_scanner

Try generating "normal" traffic (without port_scanner):

* a ping from h1 -> h2
* a TCP client connecting to a single port (e.g. `S06_Part03_Script_TCP_Client.py` on port 5000)
* several repeated connections to the same port

Questions:

* Does the alert trigger in this case as well?
* What is the difference in pattern compared to a classic multi-port scan?

---

### 6. Deliverable Stage 5

Create a file:

```text
scan_detection.txt
```

which contains:

1. A fragment of output from `detect_scan.py` while port_scanner was running,
   including at least one `[ALERT] ...` line.
2. A fragment of output from `detect_scan.py` during "normal" traffic
   (without port_scanner running).
3. A short summary (6–8 sentences) in which you explain:

   * what condition the script uses to decide that a port scan is occurring
   * how `WINDOW_SECONDS` and `PORT_THRESHOLD` affect sensitivity
   * what type of false positive you might encounter with such a simple detector
   * how it could be improved (e.g. differentiating by port type,
     separate accounting for TCP/UDP, using a genuine sliding window and so on)

---

### Connection with Stage 6 (mini_ids.py)

In Stage 6 (final assignment) you will:

* extend the ideas from here into a `mini_ids.py` script
* combine packet filtering with pattern detection (scan, flood and so on)
* log "ALERT" events to a dedicated file

For now, ensure that:

* detect_scan works correctly
* you can trigger a port scan in a controlled manner using port_scanner.py
* you have saved the logs in `scan_detection.txt`
